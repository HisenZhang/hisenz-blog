---
import BaseLayout from '../../../layouts/BaseLayout.astro'
import BlogCard from '../../../components/BlogCard.astro'
import { getCollection } from 'astro:content'
import { SITE_BASE } from '../../../consts'

export async function getStaticPaths() {
	const allPosts = await getCollection('blog')
	const categories = [...new Set(allPosts.map((post) => post.data.category).filter(Boolean))]

	return categories.map((category) => ({
		params: { category },
		props: {
			posts: allPosts
				.filter((post) => post.data.category === category)
				.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()),
		},
	}))
}

const { category } = Astro.params
const { posts } = Astro.props

// Capitalize first letter for display
const categoryDisplay = category ? category.charAt(0).toUpperCase() + category.slice(1) : ''
---

<BaseLayout
	title={`${categoryDisplay} Posts`}
	description={`Browse all ${categoryDisplay.toLowerCase()} posts`}
>
	<main class="app-container py-36 md:py-48 pt-44 md:pt-56">
		<div class="mb-12">
			<a
				href={`${SITE_BASE}/blog`}
				class="text-primary dark:text-primary-dark hover:underline mb-4 inline-block"
			>
				‚Üê Back to all posts
			</a>
			<h1 class="text-6xl font-bold mb-4">
				{categoryDisplay}
			</h1>
			<p class="text-xl opacity-70">
				{posts.length} {posts.length === 1 ? 'post' : 'posts'} in this category
			</p>
		</div>

		<div class="posts-grid-container">
			{posts.map((post) => <BlogCard post={post} />)}
		</div>
	</main>
</BaseLayout>
